JT's original code + modifications for AG
